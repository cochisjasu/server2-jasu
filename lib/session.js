const _0xbbf57=_0x5314;(function(_0x2d36a9,_0x264556){const _0x3b0808=_0x5314,_0xec93de=_0x2d36a9();while(!![]){try{const _0x599783=-parseInt(_0x3b0808(0x1b2))/0x1*(-parseInt(_0x3b0808(0x285))/0x2)+parseInt(_0x3b0808(0x280))/0x3+parseInt(_0x3b0808(0x1a2))/0x4+parseInt(_0x3b0808(0x23f))/0x5+-parseInt(_0x3b0808(0x217))/0x6*(parseInt(_0x3b0808(0x1b5))/0x7)+-parseInt(_0x3b0808(0x1b9))/0x8*(-parseInt(_0x3b0808(0x1c9))/0x9)+-parseInt(_0x3b0808(0x235))/0xa;if(_0x599783===_0x264556)break;else _0xec93de['push'](_0xec93de['shift']());}catch(_0xd4cd31){_0xec93de['push'](_0xec93de['shift']());}}}(_0x10a9,0x4103c));const Sequelize=require(_0xbbf57(0x238)),Op=Sequelize['Op'],useragent=require(_0xbbf57(0x268)),sha256=require(_0xbbf57(0x21e)),isIp=require(_0xbbf57(0x230)),hex=require(_0xbbf57(0x1ff)),cryptoRandomString=require(_0xbbf57(0x1ec)),{logError,destroyCache,getTime,baseConfig,ip_api,redis,pubsub,recaptcha,resolve_i18n,mandrillConfig}=require(_0xbbf57(0x23c)),user=require('./user'),i18n=require('./i18n'),timezone=require(_0xbbf57(0x248)),moment=require('moment'),mail=require(_0xbbf57(0x215)),{UserPassword}=require('../models/user'),model=require(_0xbbf57(0x1d8));class ClientOS{static [_0xbbf57(0x26f)]=async _0x1957e5=>{const _0x364226=_0xbbf57;try{const _0x161867=_0x364226(0x23d)+_0x1957e5,_0x874910=await redis['get'](_0x161867);if(_0x874910)return JSON['parse'](_0x874910);let _0x157ff2=await model[_0x364226(0x1bb)][_0x364226(0x1ed)]({'where':{'name':_0x1957e5}});if(_0x157ff2)_0x157ff2=_0x157ff2['get']({'plain':!![]});return await redis[_0x364226(0x234)](_0x161867,JSON[_0x364226(0x1d2)](_0x157ff2)),_0x157ff2;}catch(_0x23def5){logError(_0x23def5,_0x364226(0x220));}};static [_0xbbf57(0x237)]=async _0x5506a8=>{const _0x1a6015=_0xbbf57;try{let _0x43d1aa=await this['getByName'](_0x5506a8);if(_0x43d1aa)return _0x43d1aa;return await model[_0x1a6015(0x1bb)][_0x1a6015(0x1c1)]({'name':_0x5506a8}),await redis[_0x1a6015(0x202)](_0x1a6015(0x23d)+_0x5506a8),_0x43d1aa=await this[_0x1a6015(0x26f)](_0x5506a8),_0x43d1aa;}catch(_0x48175f){logError(_0x48175f,_0x1a6015(0x24f));}};static [_0xbbf57(0x204)]=async()=>{const _0x5a2cc8=_0xbbf57;try{const _0xb92776=_0x5a2cc8(0x1a3),_0x4324cd=await redis['get'](_0xb92776);if(_0x4324cd)return JSON['parse'](_0x4324cd);const _0x10be37=await model['ClientOS'][_0x5a2cc8(0x204)]();return await redis[_0x5a2cc8(0x234)](_0xb92776,JSON[_0x5a2cc8(0x1d2)](_0x10be37)),_0x10be37;}catch(_0x16f40a){logError(_0x16f40a,_0x5a2cc8(0x1d5));}};static [_0xbbf57(0x26d)]=async()=>{const _0x57a2de=_0xbbf57;try{const _0x14b2ab=_0x57a2de(0x1cc),_0x2737f2=await redis[_0x57a2de(0x1cb)](_0x14b2ab);if(_0x2737f2)return JSON['parse'](_0x2737f2);const _0x3610dd=[['id',_0x57a2de(0x1a8)]];let _0x3c5102=await model[_0x57a2de(0x1bb)][_0x57a2de(0x25a)]({'order':_0x3610dd});return _0x3c5102=_0x3c5102[_0x57a2de(0x22c)](_0x4bb865=>_0x4bb865['get']({'plain':!![]})),await redis[_0x57a2de(0x234)](_0x14b2ab,JSON[_0x57a2de(0x1d2)](_0x3c5102)),_0x3c5102;}catch(_0x9eeb8d){logError(_0x9eeb8d,'6NK3CA4G');}};}function _0x5314(_0x161617,_0x3e9c2b){const _0x10a9ca=_0x10a9();return _0x5314=function(_0x5314cf,_0x6aa9e1){_0x5314cf=_0x5314cf-0x1a2;let _0x4e0d12=_0x10a9ca[_0x5314cf];return _0x4e0d12;},_0x5314(_0x161617,_0x3e9c2b);}class ClientBrowser{static [_0xbbf57(0x26f)]=async _0x177005=>{const _0x476a33=_0xbbf57;try{const _0x4aeb83=_0x476a33(0x1dd)+_0x177005,_0x40c97e=await redis['get'](_0x4aeb83);if(_0x40c97e)return JSON[_0x476a33(0x205)](_0x40c97e);let _0xa036eb=await model[_0x476a33(0x1e4)][_0x476a33(0x1ed)]({'where':{'name':_0x177005}});if(_0xa036eb)_0xa036eb=_0xa036eb[_0x476a33(0x1cb)]({'plain':!![]});return await redis[_0x476a33(0x234)](_0x4aeb83,JSON['stringify'](_0xa036eb)),_0xa036eb;}catch(_0x47eab9){logError(_0x47eab9,_0x476a33(0x1dc));}};static [_0xbbf57(0x237)]=async _0x9cdb6f=>{const _0x4c0e18=_0xbbf57;try{let _0x90384c=await this[_0x4c0e18(0x26f)](_0x9cdb6f);if(_0x90384c)return _0x90384c;return await model[_0x4c0e18(0x1e4)][_0x4c0e18(0x1c1)]({'name':_0x9cdb6f}),await redis[_0x4c0e18(0x202)]('clientBrowser:name='+_0x9cdb6f),_0x90384c=await this[_0x4c0e18(0x26f)](_0x9cdb6f),_0x90384c;}catch(_0x7d941c){logError(_0x7d941c,_0x4c0e18(0x270));}};static [_0xbbf57(0x204)]=async()=>{const _0x2c0b40=_0xbbf57;try{const _0x291d7b=_0x2c0b40(0x1e1),_0x165058=await redis[_0x2c0b40(0x1cb)](_0x291d7b);if(_0x165058)return JSON[_0x2c0b40(0x205)](_0x165058);const _0x4916a7=await model[_0x2c0b40(0x1e4)][_0x2c0b40(0x204)]();return await redis[_0x2c0b40(0x234)](_0x291d7b,JSON[_0x2c0b40(0x1d2)](_0x4916a7)),_0x4916a7;}catch(_0x186e3b){logError(_0x186e3b,_0x2c0b40(0x1c2));}};static [_0xbbf57(0x26d)]=async()=>{const _0x1a5ca8=_0xbbf57;try{const _0x4f0cc8=_0x1a5ca8(0x26e),_0x2c2d60=await redis[_0x1a5ca8(0x1cb)](_0x4f0cc8);if(_0x2c2d60)return JSON[_0x1a5ca8(0x205)](_0x2c2d60);const _0x4a3e4e=[['id',_0x1a5ca8(0x1a8)]];let _0x881d2b=await model[_0x1a5ca8(0x1e4)][_0x1a5ca8(0x25a)]({'order':_0x4a3e4e});return _0x881d2b=_0x881d2b[_0x1a5ca8(0x22c)](_0xfae32a=>_0xfae32a[_0x1a5ca8(0x1cb)]({'plain':!![]})),await redis[_0x1a5ca8(0x234)](_0x4f0cc8,JSON[_0x1a5ca8(0x1d2)](_0x881d2b)),_0x881d2b;}catch(_0x119a42){logError(_0x119a42,_0x1a5ca8(0x206));}};}class ClientPlatform{static [_0xbbf57(0x26f)]=async _0xe8bcc1=>{const _0x5ae088=_0xbbf57;try{const _0x567348=_0x5ae088(0x249)+_0xe8bcc1,_0x289ed4=await redis['get'](_0x567348);if(_0x289ed4)return JSON[_0x5ae088(0x205)](_0x289ed4);let _0x205f30=await model[_0x5ae088(0x1fd)][_0x5ae088(0x1ed)]({'where':{'name':_0xe8bcc1}});if(_0x205f30)_0x205f30=_0x205f30[_0x5ae088(0x1cb)]({'plain':!![]});return await redis['set'](_0x567348,JSON[_0x5ae088(0x1d2)](_0x205f30)),_0x205f30;}catch(_0x570732){logError(_0x570732,_0x5ae088(0x1de));}};static ['singleton']=async _0xadbd76=>{const _0x102e16=_0xbbf57;try{let _0x26a68e=await this[_0x102e16(0x26f)](_0xadbd76);if(_0x26a68e)return _0x26a68e;return await model[_0x102e16(0x1fd)][_0x102e16(0x1c1)]({'name':_0xadbd76}),await redis[_0x102e16(0x202)](_0x102e16(0x249)+_0xadbd76),_0x26a68e=await this[_0x102e16(0x26f)](_0xadbd76),_0x26a68e;}catch(_0x23953b){logError(_0x23953b,_0x102e16(0x1ab));}};static [_0xbbf57(0x204)]=async()=>{const _0x2b1f78=_0xbbf57;try{const _0x3956e9='clientPlatform:count',_0x29d7e1=await redis['get'](_0x3956e9);if(_0x29d7e1)return JSON[_0x2b1f78(0x205)](_0x29d7e1);const _0x495b21=await model[_0x2b1f78(0x1fd)][_0x2b1f78(0x204)]();return await redis[_0x2b1f78(0x234)](_0x3956e9,JSON[_0x2b1f78(0x1d2)](_0x495b21)),_0x495b21;}catch(_0x2c0140){logError(_0x2c0140,_0x2b1f78(0x1a5));}};static [_0xbbf57(0x26d)]=async()=>{const _0x328942=_0xbbf57;try{const _0x48b8b4=_0x328942(0x1e3),_0x230e2e=await redis[_0x328942(0x1cb)](_0x48b8b4);if(_0x230e2e)return JSON[_0x328942(0x205)](_0x230e2e);const _0x561012=[['id',_0x328942(0x1a8)]];let _0x39e53a=await model[_0x328942(0x1fd)]['findAll']({'order':_0x561012});return _0x39e53a=_0x39e53a[_0x328942(0x22c)](_0x2218f7=>_0x2218f7[_0x328942(0x1cb)]({'plain':!![]})),await redis['set'](_0x48b8b4,JSON['stringify'](_0x39e53a)),_0x39e53a;}catch(_0x79827){logError(_0x79827,_0x328942(0x21c));}};}class GeoIP{static [_0xbbf57(0x255)]=0xe10*0x18*0x7;static [_0xbbf57(0x1d4)]=async _0x51f6a5=>{const _0x24e2a2=_0xbbf57;try{const _0x1274b4=_0x24e2a2(0x1db)+_0x51f6a5,_0x553a34=await redis[_0x24e2a2(0x1cb)](_0x1274b4);if(_0x553a34)return JSON[_0x24e2a2(0x205)](_0x553a34);let _0x3cfd34=await ip_api(_0x51f6a5);if(_0x3cfd34)await redis[_0x24e2a2(0x278)](_0x1274b4,this[_0x24e2a2(0x255)],JSON['stringify'](_0x3cfd34));return _0x3cfd34?_0x3cfd34:{'ip':_0x51f6a5};}catch(_0x54b5f1){logError(_0x54b5f1,_0x24e2a2(0x22e));}};}function _0x10a9(){const _0x278922=['13230njkzrx','userId','Sesión\x20expirada','baseLink','1550536ZZnOxx','Timezone\x20','ClientOS','agent:id=','Localización\x20','blackList','LCARNDLT','refreshConnectedStatus','create','885IYJI7','Jasu','generateRecovery','AGDE6PAR','&locale=','MailMessage','Unknown\x20Platform','9xjCevl','/confirm?userId=','get','clientOS','Unknown\x20Browser','Password\x20Inválido','x-ssr-real-ip','DREUMBAK','isBlackListed','stringify','session:id=','getInfo','EO4T7X6U','1ZP7KQ7D','isBot','../models/session','RemoteSession','toString','ip_api:remoteAddress=','ZUZEY2GD','clientBrowser:name=','IWLSXK5R','isGreyListed','cookies','clientBrowser:count','Locale','clientPlatform','ClientBrowser','url-safe','send','O0CC7HJ2','email','region','validated','getByEmail','crypto-random-string','findOne','redeemedAt','SZWFTOGK','startOf','authorization','Inicie\x20sesión\x20para\x20acceder\x20a\x20éste\x20recurso','createdAt','format','getById','setLocale','getNonce','loggedOut:agentId=','5t_upZFXdKdU86eU-cBq9jw4_hkwkTx2Bmu86r_dbuJofFOQqbx9.IChGlSE0iyV','DESC','Address\x20','WFRA7T7P','ClientPlatform','Solicitud\x20de\x20restablecimiento\x20de\x20contraseña','crypto-js/enc-hex','AWXKXEI1','Timezone','del','Jasu\x20-\x20Solicitud\x20de\x20Suscripción','count','parse','8BLYI4D8','Z6MQ20ZX','User\x20','isTablet','JTX65CWV','session:agentId=','logout','countryCode','agent','127.0.0.1','toJSON','RemoteAddress','publish','XXAI2HVI','PU088XR1','./mail','useragent','918gwxSwF','update','whiteList','headers','\x20can\x27t\x20consume\x20services\x20using\x20x-ssr-agent\x20header','FB6P6S1L','LST4URWP','crypto-js/sha256','recovery:id=','ZDRFD7BR','agentId','loggedIn:agentId=','rootDomain','VXZ732TQ','env','browser','changedRemoteSession:agentId=','remoteSession:id=','timezone','length','BackdoorUse','map','\x20ya\x20existe','59CC8089','fullName','is-ip','confirmSignup','E2SAAX2U','x-ssr-user-agent','set','3372140jKlfLu','\x20no\x20tiene\x20password\x20definido','singleton','sequelize','AgentSession','isDesktop','P7NM1TOK','./core','clientOS:name=','companyWebsite','50155WoURpT','development','ML91P92K','1DZOLJE5','greyList','day','connectedAt','platform','remoteAddress:id=','./timezone','clientPlatform:name=','C8NO44EE','loggedOutAt','connected','ips','CWZ7514Y','ECOWLPXZ','WU67YHAZ','companyName','Session','locale','LHUOD2CV','GEOIP_EXPIRE_TIMEOUT','remoteSession:remoteAddress=',':agentId=','DCP2HM1T','version','findAll','redeemRecoveryPassword','Recovery','RemoteSession\x20',':locale=','setPassword','cookie','Recover\x20password\x20solicitude','isMobile','NONCE_EXPIRE_TIMEOUT','NODE_ENV','PT88R8KT','Session\x20','UserAgent','express-useragent','x-ssr-agent','\x20no\x20existe','User','generateId','list','clientBrowser','getByName','N1CAQUU7','test','4S7X16C5','passwordData','agent:remoteAddress=','defaultLocale','Country','verify','setex','getByAgentId','setTimezone','changedLocale:agentId=','AQMIVZY0','setConnected','nonce:id=','remoteAddress','995451ScKpZG','zip','expressGateway','AgentSession\x20','i18n_fields','470zXPAIh','34056uzWWSR','clientOS:count','warn','ABCUME6T','200.56.46.144','login','ASC','R1YEMC8H','isWhiteListed','ZRXX9IBV','AgentSession\x20no\x20existe','user','push','5H11WKT2','validatePassword','1DZSYON8','1483maMPqc','link','generateNonce'];_0x10a9=function(){return _0x278922;};return _0x10a9();}const DEV_IP=_0xbbf57(0x1a6);class RemoteAddress{static [_0xbbf57(0x284)]={'country':i18n[_0xbbf57(0x276)],'region':i18n['Region']};static [_0xbbf57(0x1f5)]=async(_0x1e08e0,_0x22b2ec=baseConfig[_0xbbf57(0x275)])=>{const _0x4572d4=_0xbbf57;try{const _0x346d74=_0x4572d4(0x247)+_0x1e08e0+_0x4572d4(0x25e)+_0x22b2ec,_0x391a71=await redis[_0x4572d4(0x1cb)](_0x346d74);if(_0x391a71)return JSON[_0x4572d4(0x205)](_0x391a71);let _0x447b78=await model[_0x4572d4(0x211)][_0x4572d4(0x1ed)]({'where':{'id':_0x1e08e0}});if(_0x447b78)_0x447b78=resolve_i18n(_0x447b78['get']({'plain':!![]}),this['i18n_fields'],_0x22b2ec);return await redis[_0x4572d4(0x234)](_0x346d74,JSON['stringify'](_0x447b78)),_0x447b78;}catch(_0x1a7ded){logError(_0x1a7ded,_0x4572d4(0x1af));}};static [_0xbbf57(0x1c1)]=async _0x2fb3fb=>{const _0x11818d=_0xbbf57;try{if(await this[_0x11818d(0x1f5)](_0x2fb3fb))throw new Error('El\x20objeto\x20'+_0x2fb3fb+_0x11818d(0x22d));const _0x4edf02=await GeoIP[_0x11818d(0x1d4)](_0x2fb3fb),_0x4fd9e0=_0x4edf02[_0x11818d(0x229)]?await timezone[_0x11818d(0x201)][_0x11818d(0x26f)](_0x4edf02[_0x11818d(0x229)]):null;return await model[_0x11818d(0x211)][_0x11818d(0x1c1)]({'id':_0x2fb3fb,'type':isIp['v6'](_0x2fb3fb)?'ipv6':'ipv4','regionId':_0x4edf02[_0x11818d(0x20d)]&&_0x4edf02[_0x11818d(0x1e9)]?_0x4edf02[_0x11818d(0x20d)]+'-'+_0x4edf02[_0x11818d(0x1e9)]:null,'countryId':_0x4edf02[_0x11818d(0x20d)],'city':_0x4edf02['city']?_0x4edf02['city']:null,'zipCode':_0x4edf02[_0x11818d(0x281)]?_0x4edf02[_0x11818d(0x281)]:null,'timezoneId':_0x4fd9e0?_0x4fd9e0['id']:null}),await destroyCache(_0x11818d(0x247)+_0x2fb3fb+'*'),await this[_0x11818d(0x1f5)](_0x2fb3fb);}catch(_0x6034d5){logError(_0x6034d5,'NJHMDZAX');}};static [_0xbbf57(0x237)]=async _0x1656dc=>{const _0x573c76=_0xbbf57;try{const _0x4cfe91=await this[_0x573c76(0x1f5)](_0x1656dc);if(!_0x4cfe91)return this[_0x573c76(0x1c1)](_0x1656dc);}catch(_0x59660d){logError(_0x59660d,_0x573c76(0x23b));}};static ['whiteList']=async _0x1accd2=>{const _0x275b03=_0xbbf57;try{return await this[_0x275b03(0x237)](_0x1accd2),await model[_0x275b03(0x211)]['update']({'whiteList':!![],'greyList':![],'blackList':![]},{'where':{'id':_0x1accd2}}),await destroyCache(_0x275b03(0x247)+_0x1accd2+'*'),!![];}catch(_0x26a235){logError(_0x26a235,_0x275b03(0x1bf));}};static [_0xbbf57(0x1aa)]=async _0x5090d9=>{const _0x5de866=_0xbbf57;try{const _0x4373de=await this['getById'](_0x5090d9);return _0x4373de?_0x4373de[_0x5de866(0x219)]:![];}catch(_0x4642a4){logError(_0x4642a4,_0x5de866(0x20a));}};static [_0xbbf57(0x1be)]=async _0x46e8a1=>{const _0x4cf33c=_0xbbf57;try{return await this[_0x4cf33c(0x237)](_0x46e8a1),await model[_0x4cf33c(0x211)][_0x4cf33c(0x218)]({'whiteList':![],'greyList':![],'blackList':!![]},{'where':{'id':_0x46e8a1}}),await destroyCache('remoteAddress:id='+_0x46e8a1+'*'),!![];}catch(_0x164eda){logError(_0x164eda,_0x4cf33c(0x213));}};static [_0xbbf57(0x1d1)]=async _0x21b935=>{const _0x56a871=_0xbbf57;try{const _0x4990f7=await this[_0x56a871(0x1f5)](_0x21b935);return _0x4990f7?_0x4990f7['blackList']:![];}catch(_0x427d22){logError(_0x427d22,_0x56a871(0x1ef));}};static [_0xbbf57(0x243)]=async _0x2f8cdf=>{const _0x594b39=_0xbbf57;try{return await this[_0x594b39(0x237)](_0x2f8cdf),await model[_0x594b39(0x211)][_0x594b39(0x218)]({'whiteList':![],'greyList':![],'blackList':![]},{'where':{'id':_0x2f8cdf}}),await destroyCache('remoteAddress:id='+_0x2f8cdf+'*'),!![];}catch(_0x4372e8){logError(_0x4372e8,_0x594b39(0x241));}};static [_0xbbf57(0x1df)]=async _0x2dabfd=>{const _0x11c1d6=_0xbbf57;try{const _0x4d9412=await this['getById'](_0x2dabfd);return _0x4d9412?_0x4d9412[_0x11c1d6(0x243)]:![];}catch(_0x35ba1c){logError(_0x35ba1c,_0x11c1d6(0x242));}};}class RemoteSession{static [_0xbbf57(0x284)]={'remoteAddress':RemoteAddress};static [_0xbbf57(0x1c1)]=async(_0x538a45,_0x5505b1)=>{const _0x4833df=_0xbbf57;try{const _0xd4d236=await AgentSession['getById'](_0x538a45);if(!_0xd4d236)throw new Error(_0x4833df(0x283)+_0x538a45+_0x4833df(0x26a));await RemoteAddress[_0x4833df(0x237)](_0x5505b1);const _0xbb37f4=cryptoRandomString({'type':'url-safe','length':0xa});await model['RemoteSession']['create']({'id':_0xbb37f4,'remoteAddressId':_0x5505b1,'isDst':![],'agentId':_0x538a45}),await destroyCache(_0x4833df(0x228)+_0xbb37f4+'*'),await destroyCache(_0x4833df(0x256)+_0x5505b1+':agentId='+_0x538a45+'*');const _0x4efa14=await this['getById'](_0xbb37f4);return await pubsub[_0x4833df(0x212)](_0x4833df(0x227)+_0x538a45,{'changedRemoteSession':_0x4efa14}),_0x4efa14;}catch(_0x581f4f){logError(_0x581f4f,_0x4833df(0x1d0));}};static ['getById']=async(_0x329b22,_0x1337be=baseConfig[_0xbbf57(0x275)])=>{const _0x55d52e=_0xbbf57;try{const _0x557e39=_0x55d52e(0x228)+_0x329b22+_0x55d52e(0x25e)+_0x1337be,_0x5341d8=await redis['get'](_0x557e39);if(_0x5341d8)return JSON[_0x55d52e(0x205)](_0x5341d8);let _0x356621=await model[_0x55d52e(0x1d9)][_0x55d52e(0x1ed)]({'where':{'id':_0x329b22}});if(_0x356621)_0x356621=resolve_i18n(_0x356621[_0x55d52e(0x1cb)]({'plain':!![]}),this[_0x55d52e(0x284)],_0x1337be);return await redis[_0x55d52e(0x234)](_0x557e39,JSON['stringify'](_0x356621)),_0x356621;}catch(_0x4871ff){logError(_0x4871ff,'6LMM3V1P');}};static ['getByAgentId']=async(_0x93b1c4,_0x16c4d4,_0x30adb7=baseConfig[_0xbbf57(0x275)])=>{const _0x329115=_0xbbf57;try{if(_0x93b1c4===_0x329115(0x20f)&&process[_0x329115(0x225)][_0x329115(0x264)]==='development'||process['env'][_0x329115(0x264)]==='test')_0x93b1c4=DEV_IP;const _0x2d9640=getTime()[_0x329115(0x1f0)](_0x329115(0x244))[_0x329115(0x1f4)](),_0x19710e=_0x329115(0x256)+_0x93b1c4+':agentId='+_0x16c4d4+':date='+_0x2d9640,_0x306675=await redis[_0x329115(0x1cb)](_0x19710e);if(_0x306675)return JSON['parse'](_0x306675);let _0x3e14c5=await model[_0x329115(0x1d9)][_0x329115(0x1ed)]({'where':{'remoteAddressId':_0x93b1c4,'agentId':_0x16c4d4,'createdAt':{[Op['gte']]:_0x2d9640}}});const _0x691364=await AgentSession[_0x329115(0x1f5)](_0x16c4d4);if(_0x3e14c5)_0x3e14c5=resolve_i18n(_0x3e14c5['get']({'plain':!![]}),this[_0x329115(0x284)],_0x691364?_0x691364[_0x329115(0x253)]['id']:_0x30adb7);return await redis['set'](_0x19710e,JSON[_0x329115(0x1d2)](_0x3e14c5)),_0x3e14c5;}catch(_0x79707b){logError(_0x79707b,_0x329115(0x24a));}};static [_0xbbf57(0x218)]=async _0x50dd13=>{const _0x5e6322=_0xbbf57;try{const _0x512ecb=await this[_0x5e6322(0x1f5)](_0x50dd13['id']);if(!_0x512ecb)throw new Error(_0x5e6322(0x25d)+_0x50dd13['id']+_0x5e6322(0x26a));await model[_0x5e6322(0x1d9)][_0x5e6322(0x218)](_0x50dd13,{'where':{'id':_0x50dd13['id']}});const _0x48fc62=await this[_0x5e6322(0x1f5)](_0x50dd13['id']);return await destroyCache('agent:id='+_0x50dd13['id']+'*'),await destroyCache(_0x5e6322(0x274)+_0x512ecb['remoteAddress']['id']+_0x5e6322(0x257)+_0x512ecb[_0x5e6322(0x221)]+'*'),await destroyCache(_0x5e6322(0x274)+_0x48fc62[_0x5e6322(0x27f)]['id']+':agentId='+_0x48fc62['agentId']+'*'),_0x48fc62;}catch(_0x81e20b){logError(_0x81e20b,'SQT8ZUIB');}};}class AgentSession{static [_0xbbf57(0x282)]=async(_0x265b1e,_0x54bccd,_0x3d62df)=>{const _0x5990a3=_0xbbf57,_0x1eb315=_0x265b1e['ips'][_0x5990a3(0x22a)]>0x0?_0x265b1e[_0x5990a3(0x24d)][0x0]:_0x265b1e['ip'];if(_0x265b1e[_0x5990a3(0x21a)][_0x5990a3(0x1f1)]){const _0x50531c=_0x265b1e[_0x5990a3(0x21a)][_0x5990a3(0x1f1)];return await this['singleton'](_0x265b1e['headers']['authorization'],_0x1eb315,_0x265b1e[_0x5990a3(0x216)]||{}),{'agentId':_0x50531c,'remoteAddress':_0x1eb315};}if(_0x265b1e[_0x5990a3(0x21a)][_0x5990a3(0x269)]&&_0x265b1e['headers'][_0x5990a3(0x1cf)]&&_0x265b1e[_0x5990a3(0x21a)][_0x5990a3(0x233)]){const _0x5c6ae8=_0x265b1e[_0x5990a3(0x21a)]['x-ssr-agent'];if(!await RemoteAddress[_0x5990a3(0x1aa)](_0x265b1e[_0x5990a3(0x24d)]?_0x265b1e[_0x5990a3(0x24d)][0x0]:_0x265b1e['ip']))throw new Error(_0x5990a3(0x1fb)+_0x1eb315+_0x5990a3(0x21b));return await this[_0x5990a3(0x237)](_0x5c6ae8,_0x265b1e[_0x5990a3(0x21a)][_0x5990a3(0x1cf)],new useragent[(_0x5990a3(0x267))]()[_0x5990a3(0x205)](_0x265b1e[_0x5990a3(0x21a)][_0x5990a3(0x233)])||{}),{'agentId':_0x5c6ae8,'remoteAddress':_0x265b1e[_0x5990a3(0x21a)]['x-ssr-real-ip']};}else{const _0x39c0f0=_0x265b1e[_0x5990a3(0x1e0)][_0x5990a3(0x20e)]?_0x265b1e[_0x5990a3(0x1e0)][_0x5990a3(0x20e)]:cryptoRandomString({'length':0x20,'type':_0x5990a3(0x1e5)});await this[_0x5990a3(0x237)](_0x39c0f0,_0x1eb315,_0x265b1e[_0x5990a3(0x216)]||{});if(!_0x265b1e['cookies'][_0x5990a3(0x20e)])_0x54bccd[_0x5990a3(0x260)](_0x5990a3(0x20e),_0x39c0f0,{'domain':'.'+baseConfig[_0x5990a3(0x223)],'path':'/','secure':!![],'expires':0x0});return{'agentId':_0x39c0f0,'remoteAddress':_0x1eb315};}};static [_0xbbf57(0x237)]=async(_0x50f57c,_0x4fccf6,_0x46c803)=>{const _0x27e002=_0xbbf57;try{if(!_0x50f57c)_0x50f57c=this[_0x27e002(0x26c)]();if(_0x4fccf6===_0x27e002(0x20f)&&(process['env'][_0x27e002(0x264)]===_0x27e002(0x240)||process['env']['NODE_ENV']===_0x27e002(0x271)))_0x4fccf6=DEV_IP;let _0xb381e4=await this[_0x27e002(0x1f5)](_0x50f57c);if(!_0xb381e4)_0xb381e4=await this['create'](_0x46c803,_0x4fccf6,_0x50f57c);const _0x39d330=await RemoteSession[_0x27e002(0x279)](_0x4fccf6,_0x50f57c);if(!_0x39d330)await RemoteSession['create'](_0xb381e4['id'],_0x4fccf6);return _0xb381e4;}catch(_0x3cffdc){logError(_0x3cffdc,'ZDGEMNCE');}};static [_0xbbf57(0x27a)]=async(_0x5b177e,_0x275d5d)=>{const _0x4587ea=_0xbbf57;try{const _0x5845f3=await timezone[_0x4587ea(0x201)][_0x4587ea(0x1f5)](_0x275d5d);if(!_0x5845f3)throw new Error(_0x4587ea(0x1ba)+_0x275d5d+_0x4587ea(0x26a));const _0x35fae3=await this[_0x4587ea(0x1f5)](_0x5b177e);if(!_0x35fae3)throw new Error(_0x4587ea(0x283)+_0x5b177e+_0x4587ea(0x26a));if(_0x35fae3[_0x4587ea(0x229)]['id']===_0x275d5d)return![];return await model[_0x4587ea(0x239)][_0x4587ea(0x218)]({'timezoneId':_0x275d5d},{'where':{'id':_0x5b177e}}),await destroyCache(_0x4587ea(0x1bc)+_0x5b177e+'*'),await pubsub[_0x4587ea(0x212)]('changedTimezone:agentId='+_0x5b177e,{'changedTimezone':_0x5845f3}),!![];}catch(_0x36602d){logError(_0x36602d,_0x4587ea(0x232));}};static ['generateId']=()=>{const _0x18d77d=_0xbbf57;return cryptoRandomString({'type':_0x18d77d(0x1e5),'length':0x24});};static [_0xbbf57(0x1c1)]=async(_0x57441b,_0x208308,_0x3c8d95=null)=>{const _0x5de39d=_0xbbf57;try{const _0x920f87=await ClientOS['singleton'](_0x57441b['os']?_0x57441b['os']:'Unknown\x20OS'),_0x2e899c=await ClientBrowser[_0x5de39d(0x237)](_0x57441b[_0x5de39d(0x226)]?_0x57441b['browser']:_0x5de39d(0x1cd)),_0x281fe5=await ClientPlatform[_0x5de39d(0x237)](_0x57441b[_0x5de39d(0x246)]?_0x57441b[_0x5de39d(0x246)]:_0x5de39d(0x1c8)),_0x2c881b=await GeoIP[_0x5de39d(0x1d4)](_0x208308),_0x26db65=await timezone[_0x5de39d(0x201)][_0x5de39d(0x26f)](_0x2c881b[_0x5de39d(0x229)]);if(!_0x3c8d95)_0x3c8d95=this[_0x5de39d(0x26c)]();const _0x563772=await i18n['Country'][_0x5de39d(0x1f5)](_0x2c881b[_0x5de39d(0x20d)]);let _0x548b63={};if(_0x563772)_0x548b63={'localeId':_0x563772[_0x5de39d(0x275)]['id']};return await model[_0x5de39d(0x239)][_0x5de39d(0x1c1)]({'id':_0x3c8d95,'clientBrowserVersion':_0x57441b[_0x5de39d(0x259)]||null,'isBot':Boolean(_0x57441b[_0x5de39d(0x1d7)])||![],'isMobile':Boolean(_0x57441b[_0x5de39d(0x262)])||![],'isTablet':Boolean(_0x57441b[_0x5de39d(0x209)])||![],'isDesktop':Boolean(_0x57441b[_0x5de39d(0x23a)])||![],'isSmartTv':Boolean(_0x57441b['isSmartTv'])||![],'clientOsId':_0x920f87['id'],'clientBrowserId':_0x2e899c['id'],'clientPlatformId':_0x281fe5['id'],'timezoneId':_0x26db65['id'],..._0x548b63}),await destroyCache(_0x5de39d(0x1bc)+_0x3c8d95+'*'),await this[_0x5de39d(0x1f5)](_0x3c8d95);}catch(_0x289caf){logError(_0x289caf,_0x5de39d(0x21d));}};static [_0xbbf57(0x1f5)]=async _0x2783c=>{const _0x2a74cd=_0xbbf57;try{if(!_0x2783c)return null;const _0xa9e2aa=_0x2a74cd(0x1bc)+_0x2783c;let _0x1726c1=await redis['get'](_0xa9e2aa);if(_0x1726c1)return _0x1726c1=JSON[_0x2a74cd(0x205)](_0x1726c1),_0x1726c1;let _0x5e0a63=await model[_0x2a74cd(0x239)][_0x2a74cd(0x1ed)]({'where':{'id':_0x2783c}});if(_0x5e0a63)_0x5e0a63=_0x5e0a63['get']({'plain':!![]});return await redis[_0x2a74cd(0x234)](_0xa9e2aa,JSON[_0x2a74cd(0x1d2)](_0x5e0a63)),_0x5e0a63;}catch(_0x56578e){logError(_0x56578e,_0x2a74cd(0x27c));}};static ['update']=async _0x2c3b5c=>{const _0x2cdd9f=_0xbbf57;try{return await model[_0x2cdd9f(0x239)][_0x2cdd9f(0x218)](_0x2c3b5c,{'where':{'id':_0x2c3b5c['id']}}),await destroyCache(_0x2cdd9f(0x1bc)+_0x2c3b5c['id']+'*'),await this['getById'](_0x2c3b5c['id']);}catch(_0x1b7142){logError(_0x1b7142,_0x2cdd9f(0x250));}};static [_0xbbf57(0x1c0)]=async _0x53fa06=>{const _0x1dcfd4=_0xbbf57;try{const _0x1d9eda=await user[_0x1dcfd4(0x26b)][_0x1dcfd4(0x1f5)](_0x53fa06);if(!_0x1d9eda)return;const _0x5eab87=await model[_0x1dcfd4(0x252)][_0x1dcfd4(0x204)]({'where':{'userId':_0x53fa06,'connected':{[Op['eq']]:!![]}}}),_0x33742a=_0x5eab87>0x0;let _0x4436eb={'id':_0x53fa06,'connected':_0x33742a};if(_0x33742a&&!_0x1d9eda[_0x1dcfd4(0x24c)])_0x4436eb[_0x1dcfd4(0x245)]=new Date();else{if(!_0x33742a&&_0x1d9eda[_0x1dcfd4(0x24c)])_0x4436eb['disconnectedAt']=new Date();}await user[_0x1dcfd4(0x26b)][_0x1dcfd4(0x218)](_0x4436eb);}catch(_0x4b09d9){logError(_0x4b09d9,_0x1dcfd4(0x214));}};static [_0xbbf57(0x27d)]=async(_0x4dcc86,_0x48e180)=>{const _0x1afbd6=_0xbbf57;try{const _0x5a83a7=await Session[_0x1afbd6(0x279)](_0x4dcc86);if(!_0x5a83a7)return;if(_0x48e180===_0x5a83a7[_0x1afbd6(0x24c)])return;await Session[_0x1afbd6(0x218)]({'id':_0x5a83a7['id'],'connected':_0x48e180}),await this['refreshConnectedStatus'](_0x5a83a7[_0x1afbd6(0x1ad)]['id']);}catch(_0x2dd55b){logError(_0x2dd55b,_0x1afbd6(0x1a9));}};static [_0xbbf57(0x1f6)]=async(_0x5da85e,_0x4af739)=>{const _0x53d3fb=_0xbbf57;try{const _0x4757b2=await i18n[_0x53d3fb(0x1e2)][_0x53d3fb(0x1f5)](_0x4af739);if(!_0x4757b2)throw new Error(_0x53d3fb(0x1bd)+_0x4af739+'\x20no\x20existe');const _0x5d77b3=await this[_0x53d3fb(0x1f5)](_0x5da85e);if(!_0x5d77b3)throw new Error(_0x53d3fb(0x283)+_0x5da85e+_0x53d3fb(0x26a));return await this['update']({'id':_0x5da85e,'localeId':_0x4af739}),await destroyCache(_0x53d3fb(0x1bc)+_0x5da85e+'*'),await pubsub[_0x53d3fb(0x212)](_0x53d3fb(0x27b)+_0x5da85e,{'changedLocale':_0x4757b2}),_0x4757b2;}catch(_0x439b75){logError(_0x439b75,_0x53d3fb(0x265));}};}class Session{static [_0xbbf57(0x263)]=0xe10;static ['requireSession']=async _0x13e171=>{const _0x1da003=_0xbbf57,_0xee239c=await this[_0x1da003(0x279)](_0x13e171);if(!_0xee239c)throw new Error(_0x1da003(0x1f2));if(_0xee239c[_0x1da003(0x24b)])throw new Error(_0x1da003(0x1b7));return _0xee239c;};static [_0xbbf57(0x1a7)]=async(_0x43d6ab,_0x26b151,_0x10d610,_0x3f9e41,_0x301a80)=>{const _0x45e28=_0xbbf57;try{const _0x476371=await user[_0x45e28(0x26b)]['getByEmail'](_0x43d6ab);if(!_0x476371)return null;if(!_0x476371[_0x45e28(0x1ea)])return null;const _0x4d7664=await this[_0x45e28(0x1b0)](_0x476371['id'],_0x26b151,_0x3f9e41,_0x10d610);if(!_0x4d7664)return null;const _0x418df0=cryptoRandomString({'type':'url-safe','length':0xa}),_0x5c4cc9=await RemoteSession[_0x45e28(0x279)](_0x301a80,_0x3f9e41);await model[_0x45e28(0x252)][_0x45e28(0x1c1)]({'id':_0x418df0,'userId':_0x476371['id'],'remoteSessionId':_0x5c4cc9['id'],'agentId':_0x3f9e41}),await destroyCache('session:id='+_0x418df0+'*'),await destroyCache(_0x45e28(0x20b)+_0x3f9e41+'*');let _0xe2a9f8=await this[_0x45e28(0x1f5)](_0x418df0);return _0xe2a9f8={..._0xe2a9f8,'connected':!![],'user':await user['User']['getById'](_0xe2a9f8[_0x45e28(0x1b6)])},await pubsub[_0x45e28(0x212)](_0x45e28(0x222)+_0x3f9e41,{'loggedIn':_0xe2a9f8}),await AgentSession[_0x45e28(0x1c0)](_0xe2a9f8[_0x45e28(0x1ad)]['id']),_0xe2a9f8;}catch(_0x408857){logError(_0x408857,_0x45e28(0x272));}};static ['signUp']=async(_0x5b1292,_0x1ec1bd,_0x37c549=null,_0x465556)=>{const _0x5e93c3=_0xbbf57;try{const {email:_0x26af2d,password:_0x2b8878,gre:_0x80d668}=_0x5b1292;if(!_0x5b1292['id'])_0x5b1292['id']=cryptoRandomString({'type':_0x5e93c3(0x1e5),'length':0xa});const _0x186f93=await user[_0x5e93c3(0x26b)][_0x5e93c3(0x1eb)](_0x26af2d);if(_0x186f93)return{'status':0x1};if(process['env'][_0x5e93c3(0x264)]===_0x5e93c3(0x240)&&_0x80d668===_0x5e93c3(0x1f9))console['warn'](_0x5e93c3(0x22b));else{const _0x31aaab=await recaptcha(_0x80d668,_0x37c549);if(!_0x31aaab['success'])return{'status':0x2};}const _0x1d6e18=await AgentSession[_0x5e93c3(0x1f5)](_0x1ec1bd);if(!_0x1d6e18)throw new Error(_0x5e93c3(0x1ac));const _0x417798=await user[_0x5e93c3(0x26b)]['create'](_0x5b1292);await this[_0x5e93c3(0x25f)](_0x5b1292['id'],_0x2b8878);const _0x574d0e=['fullName',_0x5e93c3(0x251),_0x5e93c3(0x23e),'email'][_0x5e93c3(0x22c)](_0x7b2a4=>({'name':_0x7b2a4,'content':_0x417798[_0x7b2a4]}));return _0x574d0e[_0x5e93c3(0x1ae)]({'name':_0x5e93c3(0x1b3),'content':baseConfig[_0x5e93c3(0x223)]+_0x5e93c3(0x1ca)+_0x417798['id']+_0x5e93c3(0x1c6)+_0x465556+'&email='+_0x417798[_0x5e93c3(0x1e8)]}),_0x574d0e[_0x5e93c3(0x1ae)]({'name':_0x5e93c3(0x1b8),'content':''+baseConfig[_0x5e93c3(0x223)]}),await mail[_0x5e93c3(0x1c7)][_0x5e93c3(0x1e6)](mandrillConfig['adminEmail'],_0x5e93c3(0x1c3),_0x5e93c3(0x203),_0x574d0e,_0x5e93c3(0x231)),{'status':0x3,'user':_0x417798};}catch(_0x35336a){logError(_0x35336a,_0x5e93c3(0x1d6));}};static ['closeUserSessions']=async(_0x222b87,_0x115424=[])=>{const _0x3a9d51=_0xbbf57;try{let _0x40a868=await model[_0x3a9d51(0x252)][_0x3a9d51(0x25a)]({'where':{'userId':_0x222b87,'loggedOutAt':{[Op['eq']]:null}}});_0x40a868=_0x40a868[_0x3a9d51(0x22c)](_0x43af4c=>_0x43af4c[_0x3a9d51(0x1cb)]({'plain':!![]}));for(let _0x22bfa1 in _0x40a868)if(!_0x115424['includes'](_0x40a868[_0x22bfa1]['id']))await this[_0x3a9d51(0x20c)](_0x40a868[_0x22bfa1][_0x3a9d51(0x221)],!![]);}catch(_0x283d2e){logError(_0x283d2e,_0x3a9d51(0x1b1));}};static [_0xbbf57(0x20c)]=async(_0x3e5f96,_0xb818f4=![])=>{const _0x24831a=_0xbbf57;try{let _0x501705=await this[_0x24831a(0x279)](_0x3e5f96);if(!_0x501705)return![];if(_0x501705[_0x24831a(0x24b)])return![];return _0x501705[_0x24831a(0x24b)]=new Date(),_0x501705['connected']=![],await this[_0x24831a(0x218)](_0x501705),await destroyCache('session:id='+_0x501705['id']+'*'),await destroyCache(_0x24831a(0x20b)+_0x3e5f96+'*'),await pubsub[_0x24831a(0x212)](_0x24831a(0x1f8)+_0x3e5f96,{'loggedOut':{'logout':!![],'forced':_0xb818f4}}),await AgentSession[_0x24831a(0x1c0)](_0x501705[_0x24831a(0x1ad)]['id']),!![];}catch(_0x2dd8af){logError(_0x2dd8af,_0x24831a(0x1fc));}};static [_0xbbf57(0x1f5)]=async _0x2fcf85=>{const _0x42d5f8=_0xbbf57;try{const _0x2947de=_0x42d5f8(0x1d3)+_0x2fcf85,_0x1eda9a=await redis[_0x42d5f8(0x1cb)](_0x2947de);if(_0x1eda9a){const _0x4f9fdb=JSON['parse'](_0x1eda9a);if(!_0x4f9fdb)return;return{..._0x4f9fdb,'user':await user[_0x42d5f8(0x26b)][_0x42d5f8(0x1f5)](_0x4f9fdb[_0x42d5f8(0x1ad)]['id'])};}let _0x489e6b=await model[_0x42d5f8(0x252)][_0x42d5f8(0x1ed)]({'where':{'id':_0x2fcf85}});if(_0x489e6b)_0x489e6b=_0x489e6b['get']({'plain':!![]});return await redis[_0x42d5f8(0x234)](_0x2947de,JSON[_0x42d5f8(0x1d2)](_0x489e6b)),_0x489e6b;}catch(_0xe0bc72){logError(_0xe0bc72,_0x42d5f8(0x1e7));}};static ['getByAgentId']=async _0x219071=>{const _0x35b61e=_0xbbf57;try{const _0x571ed2='session:agentId='+_0x219071,_0x4250c5=await redis[_0x35b61e(0x1cb)](_0x571ed2);if(_0x4250c5){const _0x2abca4=JSON[_0x35b61e(0x205)](_0x4250c5);if(!_0x2abca4)return;return{..._0x2abca4,'user':await user['User'][_0x35b61e(0x1f5)](_0x2abca4[_0x35b61e(0x1ad)]['id'])};}let _0x18c398=await model[_0x35b61e(0x252)]['findOne']({'where':{'agentId':_0x219071,'loggedOutAt':{[Op['eq']]:null}},'order':[[_0x35b61e(0x1f3),_0x35b61e(0x1fa)]]});if(_0x18c398)_0x18c398=_0x18c398[_0x35b61e(0x1cb)]({'plain':!![]});return await redis[_0x35b61e(0x234)](_0x571ed2,JSON[_0x35b61e(0x1d2)](_0x18c398)),_0x18c398;}catch(_0xa3230a){logError(_0xa3230a,_0x35b61e(0x207));}};static [_0xbbf57(0x218)]=async _0x287c2e=>{const _0x22f61c=_0xbbf57;try{const _0x11777b=this['getById'](_0x287c2e['id']);if(!_0x11777b)throw new Error(_0x22f61c(0x266)+_0x287c2e['id']+_0x22f61c(0x26a));return await model[_0x22f61c(0x252)][_0x22f61c(0x218)](_0x287c2e,{'where':{'id':_0x287c2e['id']}}),await destroyCache(_0x22f61c(0x1d3)+_0x287c2e['id']+'*'),await destroyCache(_0x22f61c(0x20b)+_0x11777b[_0x22f61c(0x221)]+'*'),await this[_0x22f61c(0x1f5)](_0x287c2e['id']);}catch(_0x14b652){logError(_0x14b652,'0EX26S4L');}};static [_0xbbf57(0x277)]=async _0x1ebc31=>{const _0x3c3f13=_0xbbf57;try{const _0x15b687=await this[_0x3c3f13(0x1f5)](_0x1ebc31);if(!_0x15b687)return![];return!Boolean(_0x15b687[_0x3c3f13(0x24b)]);}catch(_0x379402){logError(_0x379402,'ZZYH47D9');}};static [_0xbbf57(0x1b4)]=async()=>{const _0x4078ac=_0xbbf57;try{while(!![]){const _0x4f47eb=cryptoRandomString({'length':0xc,'type':_0x4078ac(0x1e5)}),_0x47d666=_0x4078ac(0x27e)+_0x4f47eb,_0x209c3a=await redis[_0x4078ac(0x1cb)](_0x47d666);if(!_0x209c3a){const _0x27f175=cryptoRandomString({'length':0x20,'type':_0x4078ac(0x1e5)});return await redis['setex'](_0x47d666,this[_0x4078ac(0x263)],_0x27f175),{'id':_0x4f47eb,'data':_0x27f175};}}}catch(_0x6e3ce){logError(_0x6e3ce,_0x4078ac(0x1c5));}};static [_0xbbf57(0x1f7)]=async _0x1239c5=>{const _0x5bfacf=_0xbbf57;try{return await redis['get'](_0x5bfacf(0x27e)+_0x1239c5);}catch(_0x4187f7){logError(_0x4187f7,_0x5bfacf(0x254));}};static [_0xbbf57(0x25f)]=async(_0x13bd4a,_0x3a86b6)=>{const _0x2ef5e0=_0xbbf57;try{if(!await user[_0x2ef5e0(0x26b)]['getById'](_0x13bd4a))throw new Error(_0x2ef5e0(0x208)+_0x13bd4a+_0x2ef5e0(0x26a));if(_0x3a86b6[_0x2ef5e0(0x1da)]()[_0x2ef5e0(0x22a)]!==0x40)throw new Error(_0x2ef5e0(0x1ce));await UserPassword[_0x2ef5e0(0x1c1)]({'userId':_0x13bd4a,'passwordData':_0x3a86b6});}catch(_0x531f65){logError(_0x531f65,_0x2ef5e0(0x200));}};static [_0xbbf57(0x1b0)]=async(_0x4e5875,_0x266315,_0x4375d4=null,_0x498d1b=null)=>{const _0x293499=_0xbbf57;try{const _0x345086=await UserPassword[_0x293499(0x1ed)]({'where':{'userId':_0x4e5875},'order':[[_0x293499(0x1f3),'DESC']]});if(!_0x345086)throw new Error('User\x20'+_0x4e5875+_0x293499(0x236));const _0x43f533=_0x345086[_0x293499(0x1cb)]({'plain':!![]})[_0x293499(0x273)];if(_0x4375d4&&_0x498d1b){const _0x16e51d=await this[_0x293499(0x1f7)](_0x498d1b);if(!_0x16e51d)return![];await destroyCache('nonce:id='+_0x498d1b);const _0x4b7e83=hex[_0x293499(0x1d2)](sha256(''+_0x4375d4+_0x43f533+_0x16e51d));return _0x266315===_0x4b7e83;}return hex['stringify'](sha256(_0x266315))===_0x43f533;}catch(_0x59a886){logError(_0x59a886,_0x293499(0x224));}};static ['getUserByAgentId']=async _0x33395a=>{const _0x26a969=_0xbbf57;try{const _0x1eed8c=await this[_0x26a969(0x279)](_0x33395a);if(!_0x1eed8c)return null;return await this[_0x26a969(0x1f5)](_0x1eed8c[_0x26a969(0x1ad)]['id']);}catch(_0x3aa7ea){logError(_0x3aa7ea,_0x26a969(0x24e));}};}class Recovery{static ['getById']=async _0x4733d0=>{const _0xf4dd28=_0xbbf57;try{const _0x19bd73=_0xf4dd28(0x21f)+_0x4733d0,_0x57169b=await redis[_0xf4dd28(0x1cb)](_0x19bd73);if(_0x57169b)return JSON[_0xf4dd28(0x205)](_0x57169b);let _0xa0e53e=await model[_0xf4dd28(0x25c)][_0xf4dd28(0x1ed)]({'where':{'id':_0x4733d0}});if(_0xa0e53e)_0xa0e53e=_0xa0e53e['get']({'plain':!![]});return await redis[_0xf4dd28(0x234)](_0x19bd73,JSON[_0xf4dd28(0x1d2)](_0xa0e53e)),_0xa0e53e;}catch(_0xbb5b47){logError(_0xbb5b47,'UXX0X0KC');}};static [_0xbbf57(0x1c4)]=async(_0x22f22c,_0x4f90a1,_0x1409ab,_0x2328a2)=>{const _0xf4f4bd=_0xbbf57;try{const _0x5b5306=await user[_0xf4f4bd(0x26b)]['getByEmail'](_0x22f22c);if(!_0x5b5306)return![];if(process[_0xf4f4bd(0x225)][_0xf4f4bd(0x264)]==='development'&&_0x4f90a1===_0xf4f4bd(0x1f9))console[_0xf4f4bd(0x1a4)](_0xf4f4bd(0x22b));else{const _0x4aa1c6=await recaptcha(_0x4f90a1,_0x1409ab);if(!_0x4aa1c6['success'])return![];}const _0x55f17a=cryptoRandomString({'type':_0xf4f4bd(0x1e5),'length':0x40});await model['Recovery'][_0xf4f4bd(0x1c1)]({'id':_0x55f17a,'userId':_0x5b5306['id']});const _0x2f63f9=[{'name':_0xf4f4bd(0x22f),'content':_0x5b5306[_0xf4f4bd(0x22f)]},{'name':_0xf4f4bd(0x1b3),'content':baseConfig['rootDomain']+'/newPassword?recoverId='+_0x55f17a},{'name':'baselink','content':baseConfig[_0xf4f4bd(0x223)]}];return await mail[_0xf4f4bd(0x1c7)][_0xf4f4bd(0x1e6)](_0x5b5306['email'],_0xf4f4bd(0x1c3),_0x2328a2==='en'?_0xf4f4bd(0x261):_0xf4f4bd(0x1fe),_0x2f63f9,'recoverPassword_'+_0x2328a2),await destroyCache('recovery:id='+_0x55f17a),!![];}catch(_0x17b90e){logError(_0x17b90e,_0xf4f4bd(0x258));}};static [_0xbbf57(0x25b)]=async(_0x55c689,_0x5ef84f,_0x3a0a6a,_0x2eb768=null)=>{const _0x162acb=_0xbbf57;try{const _0x358fe5=await this['getById'](_0x55c689);if(!_0x358fe5)return{'status':0x1};if(_0x358fe5[_0x162acb(0x1ee)])return{'status':0x2};await Session[_0x162acb(0x25f)](_0x358fe5['userId'],_0x5ef84f),await model[_0x162acb(0x25c)][_0x162acb(0x218)]({'redeemedAt':moment()[_0x162acb(0x210)]()},{'where':{'id':_0x55c689}}),await destroyCache(_0x162acb(0x21f)+_0x55c689);const _0x5182e9=await RemoteSession['getByAgentId'](_0x2eb768,_0x3a0a6a),_0x3d3ee8=cryptoRandomString({'type':'url-safe','length':0xa});await model['Session'][_0x162acb(0x1c1)]({'id':_0x3d3ee8,'userId':_0x358fe5[_0x162acb(0x1b6)],'remoteSessionId':_0x5182e9['id'],'agentId':_0x3a0a6a});let _0xbec345=await Session['getById'](_0x3d3ee8);return await destroyCache('session:id='+_0x3d3ee8+'*'),await destroyCache(_0x162acb(0x20b)+_0x3a0a6a+'*'),await pubsub[_0x162acb(0x212)](_0x162acb(0x222)+_0x3a0a6a,{'loggedIn':_0xbec345}),{'status':0x0,'session':_0xbec345};}catch(_0x4bc37e){logError(_0x4bc37e,'H0H52R2K');}};}module['exports']={'GeoIP':GeoIP,'ClientOS':ClientOS,'ClientBrowser':ClientBrowser,'ClientPlatform':ClientPlatform,'AgentSession':AgentSession,'RemoteAddress':RemoteAddress,'RemoteSession':RemoteSession,'Session':Session,'Recovery':Recovery};